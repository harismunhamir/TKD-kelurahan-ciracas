<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bayaran Taekwondo</title>
  <link rel="stylesheet" href="Bayaran.css" />
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">
        <img src="Logo Loyal.png" alt="Logo Taekwondo">
      </div>
      <nav>
        <ul>
          <li><a href="Data-Murid.html">üìñ Data Murid</a></li>
          <li><a href="Absensi.html">üìù Absensi</a></li>
          <li><a href="Bayaran.html" class="active">üí∞ Bayaran</a></li>
          <li><a href="event-management.html">üéØ Event Management</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Konten utama -->
    <main class="content">
      <header>
        <h1>Bayaran Taekwondo</h1>
    <div class="header-actions" id="headerActions">
        <span id="welcomeMessage">Welcome, User</span>
        <button id="logoutBtn" class="primary">Logout</button>
    </div>
      </header>

      <!-- Laporan Bulanan -->
      <section class="laporan-panel panel">
        <div class="toolbar">
          <div class="left">
            <label for="tahunSelect">Tahun:</label>
            <select id="tahunSelect">
              <option value="2024">2024</option>
              <option value="2025" selected>2025</option>
              <option value="2026">2026</option>
            </select>
            
            <label for="bulanSelect">Bulan:</label>
            <select id="bulanSelect">
              <option value="1">Januari</option>
              <option value="2">Februari</option>
              <option value="3">Maret</option>
              <option value="4">April</option>
              <option value="5">Mei</option>
              <option value="6">Juni</option>
              <option value="7">Juli</option>
              <option value="8">Agustus</option>
              <option value="9">September</option>
              <option value="10">Oktober</option>
              <option value="11">November</option>
              <option value="12">Desember</option>
            </select>
            
            <!-- LOAD LAPORAN BUTTON DIHAPUS -->
          </div>
          <div class="right">
            <button id="exportExcelBtn" class="primary">Export Excel</button>
          </div>
        </div>

        <div id="laporanContainer" class="laporan-container">
          <div class="laporan-card">
            <h3>Laporan Bulanan</h3>
            <div class="laporan-grid">
              <div class="laporan-item">
                <span class="label">Total Murid</span>
                <span class="value" id="totalMurid">0 anak</span>
              </div>
              <div class="laporan-item">
                <span class="label">Sudah Bayar</span>
                <span class="value" id="sudahBayar">0 anak (0%)</span>
              </div>
              <div class="laporan-item">
                <span class="label">Belum Bayar</span>
                <span class="value" id="belumBayar">0 anak (0%)</span>
              </div>
              <div class="laporan-item">
                <span class="label">Target Pemasukan</span>
                <span class="value" id="targetPemasukan">Rp 0</span>
              </div>
              <div class="laporan-item">
                <span class="label">Realisasi Pemasukan</span>
                <span class="value" id="realisasiPemasukan">Rp 0</span>
              </div>
              <div class="laporan-item">
                <span class="label">Selisih</span>
                <span class="value" id="selisih">Rp 0</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Data Bayaran -->
      <section class="data-panel panel">
        <!-- SEARCH BAR -->
        <div class="search-container">
          <input type="text" id="searchInput" placeholder="Cari ..." class="search-input">
          <span class="search-icon">üîç</span>
        </div>

        <div class="table-container">
          <div class="table-wrap">
            <table id="bayaranTable">
              <thead>
                <tr>
                  <th>No</th>
                  <th class="sortable" data-sort="nama">Nama</th>
                  <th class="sortable" data-sort="sabuk">Sabuk</th>
                  <th class="sortable" data-sort="usia">Usia</th>
                  <th>Lama Latihan</th>
                  <th>Status</th>
                  <th>Jan</th><th>Feb</th><th>Mar</th><th>Apr</th><th>Mei</th><th>Jun</th>
                  <th>Jul</th><th>Agu</th><th>Sep</th><th>Okt</th><th>Nov</th><th>Des</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody id="bayaranBody">
                <tr>
                  <td colspan="20" style="text-align: center; padding: 20px;">
                    Pilih tahun dan bulan untuk memuat data bayaran
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
  </div>

    <!-- Tambahkan sebelum </body> di Bayaran.html -->

<!-- Modal Detail Pembayaran -->
<div id="detailModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Detail Pembayaran</h3>
      <span class="close">&times;</span>
    </div>
    <div class="modal-body">
      <form id="detailForm">
        <input type="hidden" id="detailMuridId">
        <input type="hidden" id="detailTahun">
        <input type="hidden" id="detailBulan">
        
        <div class="form-group">
          <label>Metode Bayar:</label>
          <select id="metodeBayar" class="form-select">
            <option value="">-- Pilih Metode --</option>
            <option value="cash">üíµ Cash</option>
            <option value="bank">üè¶ Transfer Bank</option>
          </select>
        </div>

        <div id="cashFields" class="form-group hidden">
          <label>Diterima oleh:</label>
          <input type="text" id="namaPenerima" placeholder="Nama penerima cash" class="form-input">
        </div>

        <div id="bankFields" class="form-group hidden">
          <label>Bank Tujuan:</label>
          <select id="bankTujuan" class="form-select">
            <option value="">-- Pilih Bank --</option>
            <option value="BCA">BCA</option>
            <option value="Mandiri">Mandiri</option>
            <option value="BNI">BNI</option>
            <option value="BRI">BRI</option>
            <option value="BSI">BSI</option>
            <option value="Lainnya">Bank Lainnya</option>
          </select>
        </div>

        <div class="form-group">
          <label>Upload Bukti (Optional):</label>
          <input type="file" id="buktiBayar" accept="image/*" class="form-input">
          <div id="previewContainer" class="preview-container hidden"></div>
        </div>

        <div class="form-actions">
          <button type="submit" class="primary">Simpan Detail</button>
          <button type="button" id="cancelDetail" class="secondary">Batal</button>
        </div>
      </form>
    </div>
  </div>
</div>
  <!-- Supabase UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>


<!-- COMBINED AUTH CHECK + HEADER MANAGEMENT -->
<script>
(function() {
    // ====== AUTH CHECK ======
    const session = localStorage.getItem('taekwondo_session');
    if (!session) {
        window.location.href = 'login.html';
        return;
    }

    const sessionData = JSON.parse(session);
    const twoHours = 2 * 60 * 60 * 1000;
    
    if (Date.now() - sessionData.loginTime > twoHours) {
        localStorage.removeItem('taekwondo_session');
        window.location.href = 'login.html';
        return;
    }

    const user = sessionData.user;
    const currentPage = window.location.pathname.split('/').pop();
    
    // Pengajar can only access Absensi.html
    if (user.role === 'pengajar' && currentPage !== 'Absensi.html') {
        window.location.href = 'Absensi.html';
        return;
    }

    // ====== HEADER MANAGEMENT ======
    document.getElementById('welcomeMessage').textContent = `Welcome, ${user.nama}`;
    
    // Add User Management button for admin
    if (user.role === 'admin') {
        const headerActions = document.getElementById('headerActions');
        const userMgmtBtn = document.createElement('a');
        userMgmtBtn.href = 'user-management.html';
        userMgmtBtn.className = 'primary';
        userMgmtBtn.textContent = 'üë• User Management';
        userMgmtBtn.style.marginRight = '10px';
        userMgmtBtn.style.textDecoration = 'none';
        userMgmtBtn.style.padding = '8px 12px';
        userMgmtBtn.style.display = 'inline-block';
        
        headerActions.insertBefore(userMgmtBtn, document.getElementById('logoutBtn'));
    }

    // Logout functionality
    document.getElementById('logoutBtn').addEventListener('click', function() {
        localStorage.removeItem('taekwondo_session');
        window.location.href = 'login.html';
    });

})();
</script>
  <!-- Script lokal -->
  <script src="Bayaran.js"></script>
</body>
</html>